#!/usr/bin/env bash
set -euo pipefail

CONTAINER=${KM_MCP_CONTAINER:-duskmantle}
# shellcheck disable=SC2086
exec docker exec -i "$CONTAINER" \
  env \
    KM_GATEWAY_URL="${KM_GATEWAY_URL:-http://localhost:8000}" \
    ${KM_READER_TOKEN+KM_READER_TOKEN="$KM_READER_TOKEN"} \
    ${KM_ADMIN_TOKEN+KM_ADMIN_TOKEN="$KM_ADMIN_TOKEN"} \
    ${KM_MCP_BACKUP_SCRIPT+KM_MCP_BACKUP_SCRIPT="$KM_MCP_BACKUP_SCRIPT"} \
    ${KM_MCP_REPO_ROOT+KM_MCP_REPO_ROOT="$KM_MCP_REPO_ROOT"} \
  gateway-mcp --transport stdio "$@"
