{% extends "base.html" %}

{% block title %}Duskmantle Console · Search{% endblock %}

{% block content %}
<section class="dm-card dm-card--wide">
  <h2>Hybrid Search</h2>
  <p class="dm-note">Profile: <strong>{{ weight_profile }}</strong>. Vector weight {{ weights.vector_weight }}, lexical weight {{ weights.lexical_weight }}.</p>
  <form id="dm-search-form" class="dm-form" autocomplete="off">
    <label>Query
      <input type="text" name="query" placeholder="Find design docs, subsystems, incidents…" required />
    </label>
    <div class="dm-form__row">
      <label>Limit
        <input type="number" name="limit" min="1" max="20" value="5" />
      </label>
      <label class="dm-checkbox">
        <input type="checkbox" name="include_graph" checked /> Include graph context
      </label>
    </div>
    <fieldset class="dm-form__fieldset">
      <legend>Symbol filters (optional)</legend>
      <div class="dm-chip-groups">
        <div class="dm-chip-group" data-dm-symbol-filter="kind">
          <span class="dm-chip-group__label">Kind</span>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="class" />
            <span>Class</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="function" />
            <span>Function</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="method" />
            <span>Method</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="interface" />
            <span>Interface</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="type" />
            <span>Type</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_kinds" value="module" />
            <span>Module</span>
          </label>
        </div>
        <div class="dm-chip-group" data-dm-symbol-filter="language">
          <span class="dm-chip-group__label">Language</span>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_languages" value="python" />
            <span>Python</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_languages" value="typescript" />
            <span>TypeScript</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_languages" value="tsx" />
            <span>TSX</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_languages" value="javascript" />
            <span>JavaScript</span>
          </label>
          <label class="dm-chip">
            <input type="checkbox" name="symbol_languages" value="go" />
            <span>Go</span>
          </label>
        </div>
      </div>
    </fieldset>
    <div class="dm-form__actions">
      <button class="dm-button" type="submit">Search</button>
      <span class="dm-form__status" role="status" aria-live="polite" data-dm-search-status>Provide a reader token before querying.</span>
    </div>
  </form>
  <div class="dm-actions" data-dm-search-actions hidden>
    <button class="dm-button dm-button--ghost" type="button" data-dm-search-copy>Copy MCP Command</button>
    <button class="dm-button dm-button--ghost" type="button" data-dm-search-download>Download Results</button>
  </div>
</section>

<section class="dm-card dm-card--wide" data-dm-search-results hidden>
  <h3>Results</h3>
  <div data-dm-search-feedback class="dm-feedback" role="status" aria-live="polite"></div>
  <div data-dm-search-filters class="dm-filter-summary" hidden></div>
  <ol data-dm-search-list class="dm-results"></ol>
</section>
{% endblock %}
