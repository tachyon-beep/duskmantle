[supervisord]
nodaemon=true
logfile=/opt/knowledge/var/logs/supervisord.log
pidfile=/opt/knowledge/var/run/supervisord.pid
logfile_maxbytes=1MB
logfile_backups=3

[unix_http_server]
file=/opt/knowledge/var/run/supervisor.sock
chmod=0700

[supervisorctl]
serverurl=unix:///opt/knowledge/var/run/supervisor.sock

[program:qdrant]
command=/opt/knowledge/bin/qdrant --config-path /opt/knowledge/etc/qdrant.yaml
stdout_logfile=/opt/knowledge/var/logs/qdrant.log
stderr_logfile=/opt/knowledge/var/logs/qdrant.err
priority=10
autostart=true
autorestart=true
startsecs=5
stopsignal=TERM

[program:neo4j]
command=/opt/knowledge/bin/neo4j-distribution/bin/neo4j console
stdout_logfile=/opt/knowledge/var/logs/neo4j.log
stderr_logfile=/opt/knowledge/var/logs/neo4j.err
priority=20
autostart=true
autorestart=true
startsecs=10
stopsignal=TERM
environment=NEO4J_HOME="/opt/knowledge/bin/neo4j-distribution",NEO4J_CONF="/opt/knowledge/etc/neo4j",JAVA_HOME="/usr/lib/jvm/java-17-openjdk-amd64"

[program:gateway]
command=/opt/knowledge/.venv/bin/uvicorn gateway.api.app:create_app --factory --host 0.0.0.0 --port 8000
stdout_logfile=/opt/knowledge/var/logs/gateway.log
stderr_logfile=/opt/knowledge/var/logs/gateway.err
priority=30
autostart=true
autorestart=true
startsecs=5
stopsignal=TERM
environment=KM_GRAPH_AUTO_MIGRATE="true"

[group:knowledge]
programs=qdrant,neo4j,gateway
